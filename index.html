{% extends "base.html" %}

{% block title %}DogeQuest - Daily Rewards{% endblock %}

{% block content %}
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ROOT VARIABLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --px-bg:         #08080f;
  --px-panel:      #0d0d1a;
  --px-panel2:     #070710;
  --px-gold:       #ffd700;
  --px-gold2:      #ffb300;
  --px-gold-dark:  #5a3a00;
  --px-green:      #00e676;
  --px-blue:       #40c4ff;
  --px-red:        #ff3d71;
  --px-text:       #dde0f0;
  --px-muted:      #4a4a6e;
  --px-border:     #1e1e3a;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BASE RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.px-wrap *, .px-wrap *::before, .px-wrap *::after {
  box-sizing: border-box;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE SHELL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.px-wrap {
  font-family: 'Press Start 2P', monospace;
  background: var(--px-bg);
  min-height: 100vh;
  position: relative;
  overflow: hidden;
}

/* Pixel grid bg */
.px-wrap::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image:
    linear-gradient(rgba(255,255,255,0.012) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,255,255,0.012) 1px, transparent 1px);
  background-size: 24px 24px;
  pointer-events: none;
  z-index: 0;
}

/* CRT scanlines */
.px-wrap::after {
  content: '';
  position: fixed;
  inset: 0;
  background: repeating-linear-gradient(
    0deg, transparent, transparent 2px,
    rgba(0,0,0,0.07) 2px, rgba(0,0,0,0.07) 4px
  );
  pointer-events: none;
  z-index: 1;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TICKER BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.px-ticker {
  position: relative;
  z-index: 20;
  background: var(--px-gold);
  overflow: hidden;
  height: 30px;
  display: flex;
  align-items: center;
  border-bottom: 4px solid var(--px-gold-dark);
}
.px-ticker span {
  display: inline-block;
  white-space: nowrap;
  font-size: 0.45rem;
  color: #0a0800;
  animation: ticker-move 28s linear infinite;
  letter-spacing: 0.08em;
}
@keyframes ticker-move {
  from { transform: translateX(100vw); }
  to   { transform: translateX(-100%); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE CONTAINER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.px-page {
  position: relative;
  z-index: 5;
  max-width: 540px;
  margin: 0 auto;
  padding: 22px 16px 56px;
  display: flex;
  flex-direction: column;
  gap: 18px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PIXEL CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.px-card {
  background: var(--px-panel);
  border: 2px solid var(--px-border);
  padding: 20px;
  position: relative;
  /* pixel-style drop shadow */
  box-shadow: 4px 4px 0 0 #030308, 0 0 0 1px #0a0a18;
  animation: card-in 0.35s ease both;
}
.px-card:nth-child(1) { animation-delay: 0.04s; }
.px-card:nth-child(2) { animation-delay: 0.10s; }
.px-card:nth-child(3) { animation-delay: 0.16s; }
.px-card:nth-child(4) { animation-delay: 0.22s; }
.px-card:nth-child(5) { animation-delay: 0.28s; }

@keyframes card-in {
  from { opacity: 0; transform: translateY(10px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* Corner accents */
.px-card::before,
.px-card::after {
  content: '';
  position: absolute;
  width: 10px; height: 10px;
  border-color: var(--px-gold);
  border-style: solid;
}
.px-card::before { top: -2px; left: -2px; border-width: 3px 0 0 3px; }
.px-card::after  { bottom: -2px; right: -2px; border-width: 0 3px 3px 0; }

/* Gold card variant */
.px-card-gold {
  background: #08080e;
  border-color: var(--px-gold-dark);
  box-shadow: 4px 4px 0 0 #020201, 0 0 0 1px #2a1800, 0 0 40px rgba(255,215,0,0.06);
}
.px-card-gold::before,
.px-card-gold::after { border-color: var(--px-gold) !important; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION LABELS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.px-label {
  font-size: 0.42rem;
  color: var(--px-muted);
  letter-spacing: 0.18em;
  text-transform: uppercase;
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 16px;
}
.px-label::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--px-border);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WELCOME CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.px-welcome {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}
.px-welcome-left { flex: 1; }
.px-welcome-eyebrow {
  font-size: 0.38rem;
  color: var(--px-muted);
  letter-spacing: 0.1em;
  margin-bottom: 10px;
}
.px-welcome-name {
  font-size: 0.9rem;
  color: var(--px-gold);
  text-shadow: 2px 2px 0 var(--px-gold-dark), 0 0 16px rgba(255,215,0,0.25);
  line-height: 1.5;
}
.px-welcome-sub {
  font-size: 0.36rem;
  color: var(--px-muted);
  margin-top: 8px;
  letter-spacing: 0.06em;
  line-height: 2;
}

/* CSS pixel dog */
.px-doge-art {
  font-size: 2.4rem;
  line-height: 1;
  animation: doge-bounce 0.9s steps(1) infinite;
}
@keyframes doge-bounce {
  0%, 100% { transform: translateY(0px); }
  50%       { transform: translateY(-4px); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MINING DASHBOARD â€” ULTRA PRO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@keyframes flicker {
  0%,91%,93%,95%,100% { opacity: 1; }
  92%,94% { opacity: 0.55; }
}

/* â”€â”€ WRAPPER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.mdb-card {
  background: #05050d;
  border: 2px solid #1a1a2e;
  position: relative;
  overflow: hidden;
  padding: 0;
  box-shadow: 4px 4px 0 0 #020204, 0 0 0 1px #0e0e20, 0 0 60px rgba(255,215,0,0.04);
  animation: card-in 0.35s .10s ease both;
}
/* Corner accents gold */
.mdb-card::before,.mdb-card::after {
  content:''; position:absolute; width:12px; height:12px;
  border-color:var(--px-gold); border-style:solid; z-index:10;
}
.mdb-card::before { top:-2px; left:-2px; border-width:3px 0 0 3px; }
.mdb-card::after  { bottom:-2px; right:-2px; border-width:0 3px 3px 0; }

/* ambient glow behind card */
.mdb-ambglow {
  position:absolute; top:-60px; left:50%; transform:translateX(-50%);
  width:340px; height:220px;
  background:radial-gradient(ellipse,rgba(255,215,0,0.055) 0%,transparent 70%);
  pointer-events:none; z-index:0;
  animation: mdb-glow-pulse 3s ease-in-out infinite;
}
.mdb-ambglow.green {
  background:radial-gradient(ellipse,rgba(0,230,118,0.07) 0%,transparent 70%);
}
@keyframes mdb-glow-pulse {
  0%,100%{ opacity:0.6; transform:translateX(-50%) scaleY(1); }
  50%    { opacity:1;   transform:translateX(-50%) scaleY(1.15); }
}

/* â”€â”€ TOP HEADER BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.mdb-header {
  position:relative; z-index:2;
  display:flex; align-items:center; justify-content:space-between;
  padding:12px 18px;
  background:linear-gradient(90deg,rgba(255,215,0,0.05) 0%,transparent 60%);
  border-bottom:1px solid #1a1a2e;
}
.mdb-header-left { display:flex; align-items:center; gap:10px; }
.mdb-tier-badge {
  font-family:'Press Start 2P',monospace;
  font-size:0.34rem; letter-spacing:0.12em;
  padding:4px 10px;
  border:1px solid;
}
.mdb-tier-badge.basic    { color:#9090b8; border-color:#2a2a4a; background:rgba(144,144,184,0.06); }
.mdb-tier-badge.bronze   { color:#ff8a65; border-color:rgba(255,138,101,0.35); background:rgba(255,138,101,0.06); }
.mdb-tier-badge.silver   { color:#b0bec5; border-color:rgba(176,190,197,0.35); background:rgba(176,190,197,0.06); }
.mdb-tier-badge.gold     { color:var(--px-gold); border-color:rgba(255,215,0,0.35); background:rgba(255,215,0,0.06); }
.mdb-tier-badge.diamond  { color:#80deea; border-color:rgba(128,222,234,0.35); background:rgba(128,222,234,0.06); }
.mdb-tier-badge.legendary{ color:#ce93d8; border-color:rgba(206,147,216,0.35); background:rgba(206,147,216,0.07); text-shadow:0 0 10px rgba(206,147,216,0.5); }

.mdb-header-title {
  font-family:'Press Start 2P',monospace;
  font-size:0.52rem; color:var(--px-text); letter-spacing:0.05em;
}

.mdb-status-pill {
  display:flex; align-items:center; gap:6px;
  font-family:'Press Start 2P',monospace;
  font-size:0.32rem; letter-spacing:0.1em;
  padding:5px 10px;
  border:1px solid;
}
.mdb-status-pill.on  { color:#00e676; border-color:rgba(0,230,118,0.3); background:rgba(0,230,118,0.06); }
.mdb-status-pill.off { color:#4a4a6e; border-color:#1a1a2e; background:transparent; }
.mdb-led {
  width:7px; height:7px;
  border-radius:0;
  background:#00e676;
  box-shadow:0 0 8px rgba(0,230,118,0.9);
  animation:mdb-blink 1s steps(1) infinite;
}
.mdb-led.off { background:#2a2a3e; box-shadow:none; animation:none; }
@keyframes mdb-blink { 0%,100%{opacity:1} 50%{opacity:0} }

/* â”€â”€ CANVAS ZONE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.mdb-canvas-zone {
  position:relative; z-index:2;
  padding:16px 18px 0;
  display:flex; gap:14px; align-items:stretch;
}

/* GPU Rig visual */
.mdb-rig {
  flex-shrink:0;
  width:96px;
  display:flex; flex-direction:column; gap:5px;
  padding:10px 8px;
  background:#030308;
  border:2px solid #1a1a2e;
  position:relative;
}
.mdb-rig::before {
  content:'RIG'; position:absolute; top:-1px; left:6px;
  font-family:'Press Start 2P',monospace; font-size:0.26rem;
  color:#2a2a4a; letter-spacing:0.1em;
}
/* GPU slot */
.mdb-gpu-slot {
  background:#07070f;
  border:1px solid #1a1a2e;
  padding:5px 6px;
  display:flex; align-items:center; gap:5px;
  position:relative;
}
.mdb-gpu-body {
  flex:1; height:8px;
  background:linear-gradient(90deg,#0a0a1a 0%,#12121f 100%);
  border:1px solid #1e1e3a;
  position:relative; overflow:hidden;
}
.mdb-gpu-heat {
  position:absolute; left:0; top:0; bottom:0;
  background:linear-gradient(90deg,transparent,var(--px-gold));
  animation:mdb-heat var(--hd,2s) ease-in-out var(--hdel,0s) infinite alternate;
}
@keyframes mdb-heat { from{width:20%} to{width:85%} }
/* fan */
.mdb-gpu-fan {
  width:10px; height:10px; flex-shrink:0;
  border:1px solid #2a2a4a;
  display:flex; align-items:center; justify-content:center;
  font-size:8px; line-height:1;
  animation:mdb-fan-spin var(--fs,0.4s) linear infinite;
}
.mdb-gpu-fan.fast { animation-duration:0.18s; }
@keyframes mdb-fan-spin { to{transform:rotate(360deg)} }
/* LEDs on slot */
.mdb-slot-led {
  width:4px; height:4px;
  background:var(--px-green);
  box-shadow:0 0 4px rgba(0,230,118,0.8);
  flex-shrink:0;
  animation:mdb-blink var(--ld,1.3s) steps(1) var(--ldel,0s) infinite;
}

/* Power supply unit at bottom */
.mdb-psu {
  margin-top:2px;
  background:#030308;
  border:1px solid #1a1a2e;
  padding:4px 6px;
  display:flex; align-items:center; gap:4px;
}
.mdb-psu-bar {
  flex:1; height:4px; background:#0a0a18; border:1px solid #1a1a2e;
  overflow:hidden;
}
.mdb-psu-fill {
  height:100%;
  background:linear-gradient(90deg,#00c853,#00e676);
  animation:mdb-psu-pulse 2s ease-in-out infinite;
}
@keyframes mdb-psu-pulse {
  0%,100%{width:70%;opacity:0.7} 50%{width:95%;opacity:1}
}
.mdb-psu-lbl {
  font-family:'Press Start 2P',monospace;
  font-size:0.22rem; color:#2a3a2e; letter-spacing:0.08em;
}

/* â”€â”€ LIVE EARNINGS PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.mdb-live-panel {
  flex:1; display:flex; flex-direction:column; gap:8px;
}

/* Big live counter */
.mdb-live-counter {
  background:#030308;
  border:2px solid #1a1a2e;
  padding:14px 12px;
  text-align:center;
  position:relative; overflow:hidden;
}
/* scan line */
.mdb-live-counter::before {
  content:''; position:absolute; left:0; right:0; height:1px;
  background:linear-gradient(90deg,transparent,rgba(0,230,118,0.4),transparent);
  animation:mdb-scan 2.5s linear infinite;
}
@keyframes mdb-scan { from{top:-2px} to{top:102%} }
.mdb-live-lbl {
  display:block; font-family:'Press Start 2P',monospace;
  font-size:0.28rem; color:#4a4a6e; letter-spacing:0.14em;
  margin-bottom:6px;
}
.mdb-live-amount {
  display:block; font-family:'Press Start 2P',monospace;
  font-size:0.9rem;
  color:var(--px-green);
  text-shadow:0 0 20px rgba(0,230,118,0.6), 2px 2px 0 #003318;
  letter-spacing:0.04em; line-height:1.2;
}
.mdb-live-unit {
  display:block; font-family:'Press Start 2P',monospace;
  font-size:0.3rem; color:#3a4a3e; letter-spacing:0.1em; margin-top:5px;
}

/* Rate pill */
.mdb-rate-row {
  display:flex; gap:6px;
}
.mdb-rate-cell {
  flex:1; background:#030308; border:1px solid #1a1a2e;
  padding:8px 6px; text-align:center;
}
.mdb-rate-val {
  display:block; font-family:'Press Start 2P',monospace;
  font-size:0.46rem; color:var(--px-gold);
  text-shadow:1px 1px 0 var(--px-gold-dark);
  margin-bottom:4px;
}
.mdb-rate-val.blue { color:var(--px-blue); text-shadow:0 0 8px rgba(64,196,255,0.4); }
.mdb-rate-lbl {
  font-size:0.26rem; color:#4a4a6e; letter-spacing:0.1em;
}

/* â”€â”€ PROGRESS / HASHRATE SECTION â”€â”€â”€â”€â”€â”€â”€â”€ */
.mdb-progress-section {
  position:relative; z-index:2;
  padding:14px 18px;
  border-top:1px solid #0e0e1a;
}
.mdb-progress-header {
  display:flex; justify-content:space-between; align-items:center;
  margin-bottom:8px;
}
.mdb-progress-title {
  font-family:'Press Start 2P',monospace;
  font-size:0.3rem; color:#4a4a6e; letter-spacing:0.12em;
}
.mdb-progress-pct {
  font-family:'Press Start 2P',monospace;
  font-size:0.36rem; color:var(--px-gold);
}
.mdb-progress-track {
  height:12px;
  background:#030308;
  border:1px solid #1a1a2e;
  overflow:hidden; position:relative;
}
/* segmented fill */
.mdb-progress-fill {
  height:100%;
  background:linear-gradient(90deg,#003318 0%,#00c853 60%,#00e676 100%);
  position:relative;
  transition:width 1s ease;
}
/* shimmer */
.mdb-progress-fill::after {
  content:''; position:absolute;
  top:0; bottom:0; width:30px;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,0.25),transparent);
  animation:mdb-shimmer 1.4s ease-in-out infinite;
  right:-30px;
}
@keyframes mdb-shimmer { from{right:-30px} to{right:110%} }
/* pixel blocks overlay */
.mdb-progress-blocks {
  position:absolute; inset:0; display:flex; gap:2px; padding:2px;
  pointer-events:none;
}
.mdb-pb {
  flex:1; height:100%;
  background:rgba(0,0,0,0.25);
}

/* â”€â”€ HASHRATE OSCILLOSCOPE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.mdb-osc-wrap {
  position:relative; z-index:2;
  padding:0 18px 14px;
}
.mdb-osc-header {
  display:flex; justify-content:space-between; margin-bottom:6px;
}
.mdb-osc-lbl {
  font-family:'Press Start 2P',monospace;
  font-size:0.28rem; color:#4a4a6e; letter-spacing:0.12em;
}
.mdb-osc-val {
  font-family:'Press Start 2P',monospace;
  font-size:0.32rem; color:var(--px-green);
  text-shadow:0 0 8px rgba(0,230,118,0.5);
}
.mdb-osc {
  height:36px;
  background:#030308;
  border:1px solid #1a1a2e;
  overflow:hidden; position:relative;
}
/* horizontal grid lines */
.mdb-osc::before {
  content:''; position:absolute; inset:0;
  background:repeating-linear-gradient(
    0deg, transparent, transparent 11px,
    rgba(255,255,255,0.03) 11px, rgba(255,255,255,0.03) 12px
  );
}
canvas#oscCanvas {
  display:block; width:100%; height:36px;
}

/* â”€â”€ TERMINAL LOG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.mdb-terminal {
  position:relative; z-index:2;
  margin:0 18px 14px;
  background:#020208;
  border:1px solid #0e0e1a;
}
.mdb-terminal-bar {
  background:#0a0a18; padding:4px 10px;
  display:flex; align-items:center; gap:6px;
  border-bottom:1px solid #0e0e1a;
}
.mdb-terminal-dot {
  width:5px; height:5px;
}
.mdb-terminal-dot:nth-child(1){ background:#ff5f56; }
.mdb-terminal-dot:nth-child(2){ background:#ffbd2e; }
.mdb-terminal-dot:nth-child(3){ background:#27c93f; }
.mdb-terminal-title {
  font-family:'Press Start 2P',monospace;
  font-size:0.24rem; color:#2a2a4a; letter-spacing:0.1em; flex:1; text-align:center;
}
.mdb-terminal-body {
  height:56px; overflow:hidden; padding:6px 10px;
  position:relative;
}
.mdb-log-stream {
  font-family:'Press Start 2P',monospace;
  font-size:0.28rem; line-height:2.2;
  letter-spacing:0.04em;
}
.mdb-log-line { display:block; }
.mdb-log-line.ok    { color:#00e676; }
.mdb-log-line.info  { color:#40c4ff; }
.mdb-log-line.warn  { color:var(--px-gold); }
.mdb-log-line.hash  { color:#9090b8; }

/* â”€â”€ MACHINES LIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.mdb-machines {
  position:relative; z-index:2;
  padding:0 18px 14px;
  display:flex; flex-direction:column; gap:6px;
}
.mdb-machine-row {
  background:#030308; border:1px solid #1a1a2e;
  display:flex; align-items:center; gap:10px; padding:8px 10px;
  position:relative;
}
.mdb-machine-row::before {
  content:''; position:absolute; left:0; top:0; bottom:0;
  width:2px; background:var(--px-green);
  box-shadow:0 0 6px rgba(0,230,118,0.5);
}
.mdb-machine-icon {
  width:28px; height:28px; flex-shrink:0;
  background:#07070f; border:1px solid #1a1a2e;
  display:flex; align-items:center; justify-content:center;
  font-size:1rem;
}
.mdb-machine-name {
  flex:1; font-family:'Press Start 2P',monospace;
  font-size:0.36rem; color:var(--px-text);
  letter-spacing:0.04em;
}
.mdb-machine-rate {
  font-family:'Press Start 2P',monospace;
  font-size:0.36rem; color:var(--px-green);
  text-shadow:0 0 6px rgba(0,230,118,0.4);
}

/* â”€â”€ FOOTER / CLAIM AREA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.mdb-footer {
  position:relative; z-index:2;
  padding:14px 18px 18px;
  border-top:1px solid #0e0e1a;
  display:flex; flex-direction:column; gap:10px;
}

/* Claim button */
.mdb-claim-btn {
  width:100%; padding:18px 16px;
  font-family:'Press Start 2P',monospace;
  font-size:0.52rem; letter-spacing:0.08em;
  background:var(--px-green); color:#020f06;
  border:2px solid #00c853;
  box-shadow:5px 5px 0 0 #002a12;
  cursor:pointer; display:flex; align-items:center; justify-content:center; gap:10px;
  position:relative; overflow:hidden;
  transition:transform .07s, box-shadow .07s;
  animation:mdb-claim-pulse 2.5s ease-in-out infinite;
}
@keyframes mdb-claim-pulse {
  0%,100%{ box-shadow:5px 5px 0 0 #002a12, 0 0 0 0 rgba(0,230,118,0); }
  50%    { box-shadow:5px 5px 0 0 #002a12, 0 0 20px 4px rgba(0,230,118,0.18); }
}
.mdb-claim-btn::before {
  content:''; position:absolute; top:-2px; left:-100%; width:60%; height:calc(100%+4px);
  background:linear-gradient(90deg,transparent,rgba(255,255,255,0.18),transparent);
  animation:mdb-claim-shine 3s ease-in-out infinite;
}
@keyframes mdb-claim-shine { to{left:150%} }
.mdb-claim-btn:hover  { transform:translate(-2px,-2px); box-shadow:7px 7px 0 0 #002a12; animation:none; }
.mdb-claim-btn:active { transform:translate(3px,3px);  box-shadow:1px 1px 0 0 #002a12; }
.mdb-claim-btn:disabled { opacity:.45; cursor:not-allowed; transform:none; animation:none; }

/* Sub link */
.mdb-sub-link {
  display:block; width:100%; padding:12px;
  font-family:'Press Start 2P',monospace;
  font-size:0.4rem; letter-spacing:0.07em;
  background:transparent; color:var(--px-gold);
  border:1px solid rgba(255,215,0,0.2);
  text-decoration:none; text-align:center;
  transition:transform .07s, border-color .1s, box-shadow .07s;
}
.mdb-sub-link:hover {
  transform:translate(-1px,-1px);
  border-color:rgba(255,215,0,0.5);
  box-shadow:3px 3px 0 0 var(--px-gold-dark);
  color:var(--px-gold);
}

/* â”€â”€ NO PLAN STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.mdb-noplan {
  padding:24px 18px 20px;
  position:relative; z-index:2;
  text-align:center;
}
.mdb-noplan-rig {
  width:64px; height:64px;
  background:#030308; border:2px solid #1a1a2e;
  display:flex; align-items:center; justify-content:center;
  margin:0 auto 16px;
  font-size:2rem; filter:grayscale(1) opacity(0.35);
}
.mdb-noplan-title {
  font-family:'Press Start 2P',monospace;
  font-size:0.52rem; color:#4a4a6e; letter-spacing:0.06em;
  margin-bottom:10px;
}
.mdb-noplan-sub {
  font-size:0.32rem; color:#2a2a4a;
  letter-spacing:0.06em; line-height:2.4; margin-bottom:20px;
}
/* mini plan preview table */
.mdb-plan-preview {
  display:flex; flex-direction:column; gap:5px; margin-bottom:18px;
}
.mdb-plan-preview-row {
  display:flex; align-items:center; gap:8px;
  background:#030308; border:1px solid #1a1a2e;
  padding:7px 10px;
}
.mdb-plan-preview-tier {
  font-family:'Press Start 2P',monospace;
  font-size:0.3rem; min-width:54px; letter-spacing:0.08em;
}
.mdb-plan-preview-rate {
  flex:1; font-family:'Press Start 2P',monospace;
  font-size:0.3rem; color:#4a4a6e;
}
.mdb-plan-preview-earn {
  font-family:'Press Start 2P',monospace;
  font-size:0.3rem; color:var(--px-green);
  text-shadow:0 0 6px rgba(0,230,118,0.4);
}
/* CTA */
.mdb-cta-btn {
  display:flex; align-items:center; justify-content:center; gap:10px;
  width:100%; padding:18px;
  font-family:'Press Start 2P',monospace;
  font-size:0.52rem; letter-spacing:0.07em;
  background:var(--px-gold); color:#040300;
  border:2px solid var(--px-gold2);
  box-shadow:5px 5px 0 0 var(--px-gold-dark), 0 0 30px rgba(255,215,0,0.2);
  text-decoration:none;
  position:relative; overflow:hidden;
  transition:transform .07s, box-shadow .07s;
}
.mdb-cta-btn::before {
  content:''; position:absolute; top:0; left:-80%; width:50%; height:100%;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,0.25),transparent);
  animation:mdb-cta-shine 2.5s ease-in-out infinite;
}
@keyframes mdb-cta-shine { to{left:130%} }
.mdb-cta-btn:hover  { transform:translate(-2px,-2px); box-shadow:7px 7px 0 0 var(--px-gold-dark), 0 0 40px rgba(255,215,0,0.35); color:#040300; }
.mdb-cta-btn:active { transform:translate(3px,3px); box-shadow:1px 1px 0 0 var(--px-gold-dark); }

/* â”€â”€ UPTIME DISPLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.mdb-uptime-row {
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 18px;
  border-top:1px solid #0a0a18;
  position:relative; z-index:2;
}
.mdb-uptime-item {
  display:flex; flex-direction:column; align-items:center; gap:3px;
}
.mdb-uptime-val {
  font-family:'Press Start 2P',monospace;
  font-size:0.42rem; color:var(--px-text);
}
.mdb-uptime-lbl {
  font-size:0.26rem; color:#3a3a5a; letter-spacing:0.1em;
}
.mdb-uptime-sep {
  width:1px; height:24px; background:#1a1a2e;
}

/* â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

/* (legacy day/reward classes â€” kept for compat) */
.px-days {
  display: flex;
  justify-content: center;
  gap: 6px;
  margin-bottom: 22px;
}
.px-day {
  width: 38px; height: 38px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.38rem;
  font-family: 'Press Start 2P', monospace;
}
.px-day.completed {
  background: var(--px-gold);
  border: 2px solid var(--px-gold2);
  box-shadow: 3px 3px 0 0 var(--px-gold-dark), 0 0 14px rgba(255,215,0,0.35);
  color: #000;
  font-size: 0.65rem;
}
.px-day.current {
  background: #120e00;
  border: 2px solid var(--px-gold);
  color: var(--px-gold);
  animation: blink-border 1.1s steps(1) infinite;
}
@keyframes blink-border {
  0%,100% { box-shadow: 0 0 0 0 transparent, 0 0 10px rgba(255,215,0,0.5); border-color: var(--px-gold); }
  50%      { box-shadow: 0 0 0 3px rgba(255,215,0,0.25), 0 0 20px rgba(255,215,0,0.6); border-color: var(--px-gold2); }
}
.px-day.locked {
  background: var(--px-panel2);
  border: 2px solid var(--px-border);
  color: var(--px-muted);
}

/* Reward display */
.px-reward-display {
  background: #050509;
  border: 2px solid var(--px-border);
  box-shadow: inset 0 0 24px rgba(0,0,0,0.4);
  padding: 20px 16px;
  text-align: center;
  margin-bottom: 18px;
  position: relative;
  overflow: hidden;
}
/* scanning line */
.px-reward-display::before {
  content: '';
  position: absolute;
  left: 0; right: 0;
  height: 2px;
  background: linear-gradient(90deg, transparent, rgba(255,215,0,0.5), transparent);
  animation: scan-line 3s linear infinite;
}
@keyframes scan-line {
  from { top: -4px; }
  to   { top: 110%; }
}

.px-reward-amount {
  display: block;
  font-size: 1.35rem;
  color: var(--px-gold);
  text-shadow: 0 0 18px rgba(255,215,0,0.55), 4px 4px 0 var(--px-gold-dark);
  margin-bottom: 10px;
  line-height: 1.2;
}
.px-reward-unit {
  display: block;
  font-size: 0.4rem;
  color: var(--px-muted);
  letter-spacing: 0.18em;
}
.px-bonus-pill {
  display: inline-block;
  margin-top: 12px;
  background: #001a0b;
  border: 2px solid var(--px-green);
  color: var(--px-green);
  font-size: 0.38rem;
  padding: 5px 10px;
  text-shadow: 0 0 8px rgba(0,230,118,0.5);
  letter-spacing: 0.08em;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.px-btn {
  width: 100%;
  padding: 17px;
  font-family: 'Press Start 2P', monospace;
  font-size: 0.58rem;
  letter-spacing: 0.07em;
  border: none;
  cursor: pointer;
  text-align: center;
  text-decoration: none;
  display: block;
  transition: transform 0.07s, box-shadow 0.07s;
  line-height: 1;
}
.px-btn-gold {
  background: var(--px-gold);
  color: #050400;
  border: 2px solid var(--px-gold2);
  box-shadow: 4px 4px 0 0 var(--px-gold-dark), 0 0 20px rgba(255,215,0,0.28);
  text-shadow: 1px 1px 0 rgba(255,255,255,0.25);
}
.px-btn-gold:hover  { transform: translate(-2px,-2px); box-shadow: 6px 6px 0 0 var(--px-gold-dark), 0 0 30px rgba(255,215,0,0.45); }
.px-btn-gold:active { transform: translate(3px,3px);  box-shadow: 1px 1px 0 0 var(--px-gold-dark); }

.px-btn-disabled {
  background: var(--px-panel2);
  color: var(--px-muted);
  border: 2px solid var(--px-border);
  box-shadow: 3px 3px 0 0 #030306;
  cursor: not-allowed;
}
.px-btn-blue {
  background: #001e3a;
  color: var(--px-blue);
  border: 2px solid #004a7a;
  box-shadow: 4px 4px 0 0 #000d1a, 0 0 14px rgba(64,196,255,0.12);
  text-shadow: 0 0 8px rgba(64,196,255,0.4);
  text-decoration: none;
}
.px-btn-blue:hover  { transform: translate(-2px,-2px); box-shadow: 6px 6px 0 0 #000d1a, 0 0 24px rgba(64,196,255,0.28); color: #fff; }
.px-btn-blue:active { transform: translate(3px,3px);  box-shadow: 1px 1px 0 0 #000d1a; }

.px-btn-ghost {
  background: transparent;
  color: var(--px-text);
  border: 2px solid var(--px-border);
  box-shadow: 3px 3px 0 0 #030308;
  text-decoration: none;
}
.px-btn-ghost:hover  { transform: translate(-2px,-2px); color: var(--px-gold); border-color: var(--px-gold-dark); box-shadow: 5px 5px 0 0 #030308; }
.px-btn-ghost:active { transform: translate(2px,2px); box-shadow: 1px 1px 0 0 #030308; }

.px-claimed-msg {
  text-align: center;
  font-size: 0.36rem;
  color: var(--px-muted);
  margin-top: 14px;
  letter-spacing: 0.06em;
  line-height: 2.4;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATS GRID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.px-stats {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}
.px-stat-box {
  background: var(--px-panel2);
  border: 2px solid var(--px-border);
  box-shadow: 3px 3px 0 0 #020205;
  padding: 16px 10px;
  text-align: center;
}
.px-stat-val {
  display: block;
  font-size: 0.72rem;
  color: var(--px-gold);
  text-shadow: 2px 2px 0 var(--px-gold-dark), 0 0 10px rgba(255,215,0,0.2);
  margin-bottom: 9px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.px-stat-lbl {
  display: block;
  font-size: 0.36rem;
  color: var(--px-muted);
  letter-spacing: 0.12em;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.px-actions {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QUEST LOG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.px-quest-list {
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.px-quest-item {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  background: var(--px-panel2);
  border: 2px solid var(--px-border);
  padding: 12px;
  position: relative;
}
.px-quest-item::before {
  content: '';
  position: absolute;
  left: 0; top: 0; bottom: 0;
  width: 3px;
  background: var(--px-gold);
}
.px-quest-num {
  flex-shrink: 0;
  width: 26px; height: 26px;
  background: var(--px-gold);
  color: #0a0800;
  font-size: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 2px 2px 0 0 var(--px-gold-dark);
}
.px-quest-text {
  font-size: 0.4rem;
  color: #7070a0;
  line-height: 2.4;
  letter-spacing: 0.04em;
}
.px-quest-text strong { color: var(--px-text); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FLOATING PIXEL SPARKLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.px-sparkles {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  overflow: hidden;
}
.px-sp {
  position: absolute;
  width: 3px; height: 3px;
  background: var(--px-gold);
  opacity: 0;
  animation: sparkle-float var(--d) ease-in-out var(--del) infinite;
}
@keyframes sparkle-float {
  0%      { opacity: 0;   transform: translateY(0) scale(1); }
  20%     { opacity: 0.5; }
  80%     { opacity: 0.3; }
  100%    { opacity: 0;   transform: translateY(-40px) scale(0.5); }
}

@media (max-width: 400px) {
  .px-welcome-name { font-size: 0.7rem; }
  .px-ci-title { font-size: 0.58rem; }
  .px-reward-amount { font-size: 1rem; }
  .px-day { width: 32px; height: 32px; }
}
</style>

<!-- Sparkles -->
<div class="px-sparkles" aria-hidden="true">
  <div class="px-sp" style="top:12%;left:10%;--d:4s;--del:0s;"></div>
  <div class="px-sp" style="top:25%;left:88%;--d:5s;--del:1s;"></div>
  <div class="px-sp" style="top:50%;left:5%;--d:3.5s;--del:0.5s;"></div>
  <div class="px-sp" style="top:65%;left:75%;--d:4.5s;--del:2s;"></div>
  <div class="px-sp" style="top:80%;left:40%;--d:3s;--del:1.5s;background:#40c4ff;"></div>
  <div class="px-sp" style="top:35%;left:55%;--d:6s;--del:0.3s;background:#00e676;"></div>
  <div class="px-sp" style="top:8%;left:65%;--d:4s;--del:2.5s;"></div>
  <div class="px-sp" style="top:90%;left:20%;--d:5s;--del:0.8s;background:#40c4ff;"></div>
</div>

<div class="px-wrap">

  <!-- Ticker -->
  <div class="px-ticker" aria-hidden="true">
    <span>
      â˜… TON QUEST DAILY REWARDS â˜…&nbsp;&nbsp;&nbsp;&nbsp;
      EARN TON EVERY DAY &nbsp;â˜…&nbsp;&nbsp;&nbsp;&nbsp;
      COMPLETE QUESTS FOR BONUS TON &nbsp;â˜…&nbsp;&nbsp;&nbsp;&nbsp;
      INVITE FRIENDS &amp; MULTIPLY YOUR EARNINGS &nbsp;â˜…&nbsp;&nbsp;&nbsp;&nbsp;
      MUCH WOW. VERY EARN. SO TON. &nbsp;â˜…&nbsp;&nbsp;&nbsp;&nbsp;
    </span>
  </div>

  <div class="px-page">

    <!-- WELCOME -->
    <div class="px-card">
      <div class="px-welcome">
        <div class="px-welcome-left">
          <div class="px-welcome-eyebrow">â–¶ PLAYER ONLINE</div>
          <div class="px-welcome-name">{{ user.first_name or 'PLAYER' }}!</div>
          <div class="px-welcome-sub">READY FOR YOUR DAILY QUEST?</div>
        </div>
        <div class="px-doge-art" aria-hidden="true">ğŸ•</div>
      </div>
    </div>

    <!-- APPLE FARM CARD -->
    <div class="px-card px-card-gold" id="appleFarmCard">
      <div class="px-label">ğŸ &nbsp;APPLE FARM</div>

      <!-- Stats row: Ã¡rboles / manzanas por hora / pendiente -->
      <div class="px-stats" style="margin-bottom:14px;">
        <div class="px-stat-box">
          <span class="px-stat-val" id="af-trees">0</span>
          <span class="px-stat-lbl">ÃRBOLES</span>
        </div>
        <div class="px-stat-box">
          <span class="px-stat-val" id="af-rate">0</span>
          <span class="px-stat-lbl">ğŸ / HORA</span>
        </div>
        <div class="px-stat-box" style="grid-column:span 2; background:#06060f; border-color:rgba(0,230,118,0.18);">
          <span class="px-stat-val" id="af-pending" style="color:var(--px-green); text-shadow:0 0 14px rgba(0,230,118,0.5), 2px 2px 0 #003318;">0</span>
          <span class="px-stat-lbl">ğŸ PENDIENTES</span>
        </div>
      </div>

      <!-- Harvest button (only visible when apples > 0) -->
      <button class="px-btn px-btn-gold" id="af-harvest-btn"
        style="display:none; margin-bottom:10px; background:var(--px-green); color:#020f06; border-color:#00c853; box-shadow:4px 4px 0 0 #003318;"
        onclick="AF.harvest()">
        ğŸ COSECHAR <span id="af-harvest-count">0</span> MANZANAS
      </button>

      <!-- Link to tree shop -->
      <a class="px-btn px-btn-gold" href="{{ url_for('mining') }}" style="text-align:center;">
        ğŸŒ³ COMPRAR ÃRBOLES â†’
      </a>

      <!-- Active trees list (populated by JS) -->
      <div id="af-tree-list" style="margin-top:14px; display:flex; flex-direction:column; gap:6px;"></div>

    </div>

    <!-- STATS -->
    <!-- STATS -->
    <div class="px-card">
      <div class="px-label">ğŸ“Š &nbsp;YOUR STATS</div>
      <div class="px-stats">
        <div class="px-stat-box">
          <span class="px-stat-val">{{ format_ton(user.doge_balance) }}</span>
          <span class="px-stat-lbl">BALANCE</span>
        </div>
        <div class="px-stat-box">
          <span class="px-stat-val">{{ format_ton(user.total_earned) }}</span>
          <span class="px-stat-lbl">TOTAL EARNED</span>
        </div>
        <div class="px-stat-box">
          <span class="px-stat-val" id="statMachines">â€”</span>
          <span class="px-stat-lbl">MACHINES</span>
        </div>
        <div class="px-stat-box">
          <span class="px-stat-val">{{ user.referral_count or 0 }}</span>
          <span class="px-stat-lbl">REFERRALS</span>
        </div>
      </div>
    </div>

    <!-- QUICK ACTIONS -->
    <div class="px-card">
      <div class="px-label">âš¡ &nbsp;QUICK ACTIONS</div>
      <div class="px-actions">
        <a href="{{ url_for('mining') }}" class="px-btn px-btn-gold">â› MINING</a>
        <a href="{{ url_for('tasks') }}" class="px-btn px-btn-blue">ğŸ“‹ TASKS</a>
        <a href="{{ url_for('referrals') }}" class="px-btn px-btn-ghost">ğŸ‘¥ INVITE</a>
        <a href="{{ url_for('wallet') }}" class="px-btn px-btn-ghost">ğŸ’° WALLET</a>
      </div>
    </div>

    <!-- HOW IT WORKS -->
    <div class="px-card">
      <div class="px-label">ğŸ’¡ &nbsp;QUEST LOG</div>
      <div class="px-quest-list">
        <div class="px-quest-item">
          <div class="px-quest-num">1</div>
          <div class="px-quest-text"><strong>BUY A MINING PLAN</strong> to start auto-earning TON</div>
        </div>
        <div class="px-quest-item">
          <div class="px-quest-num">2</div>
          <div class="px-quest-text"><strong>COMPLETE TASKS</strong> for bonus earnings</div>
        </div>
        <div class="px-quest-item">
          <div class="px-quest-num">3</div>
          <div class="px-quest-text"><strong>INVITE FRIENDS</strong> to earn referral bonuses</div>
        </div>
        <div class="px-quest-item">
          <div class="px-quest-num">4</div>
          <div class="px-quest-text"><strong>WITHDRAW</strong> your TON to your wallet</div>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APPLE FARM â€” index widget
   LÃ³gica: Ã¡rboles producen ğŸ/hr,
   cosechar suma al balance TON
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const AF = (() => {
  'use strict';

  let pending   = 0;   // manzanas acumuladas
  let pph       = 0;   // manzanas por hora
  let trees     = 0;   // total de Ã¡rboles
  let machines  = [];  // lista de mÃ¡quinas activas
  let lastTick  = Date.now();
  let tickTimer = null;

  const $ = id => document.getElementById(id);

  function fmt(n) {
    const v = Math.floor(n);
    if (v >= 1e6) return (v/1e6).toFixed(1)+'M';
    if (v >= 1e3) return (v/1e3).toFixed(1)+'k';
    return v.toString();
  }

  // Tick: acumula manzanas en tiempo real
  function tick() {
    const now = Date.now();
    const dt  = (now - lastTick) / 1000;  // segundos
    lastTick  = now;

    pending += (pph / 3600) * dt;

    const pendingInt = Math.floor(pending);

    // Actualiza display
    const pe = $('af-pending'); if (pe) pe.textContent = fmt(pending);

    // Muestra/oculta botÃ³n de cosechar
    const hBtn = $('af-harvest-btn');
    const hCnt = $('af-harvest-count');
    if (hBtn) hBtn.style.display = pendingInt >= 1 ? '' : 'none';
    if (hCnt) hCnt.textContent   = fmt(pending);
  }

  // Renderiza la lista de Ã¡rboles activos
  function renderTrees() {
    const list = $('af-tree-list');
    if (!list) return;
    if (!machines.length) { list.innerHTML = ''; return; }

    list.innerHTML = machines.map(m => {
      const emoji = getEmoji(m.plan_name || '');
      return `
        <div style="background:var(--px-panel2);border:2px solid var(--px-border);
          box-shadow:2px 2px 0 0 #020205;display:flex;align-items:center;
          gap:10px;padding:8px 10px;position:relative;">
          <div style="position:absolute;left:0;top:0;bottom:0;width:3px;
            background:var(--px-green);box-shadow:0 0 6px rgba(0,230,118,.5);"></div>
          <div style="flex-shrink:0;width:32px;height:32px;background:#07070f;
            border:1px solid var(--px-border);display:flex;align-items:center;
            justify-content:center;font-size:1.1rem;">${emoji}</div>
          <div style="flex:1;">
            <div style="font-size:0.38rem;color:var(--px-text);letter-spacing:.04em;
              margin-bottom:4px;">${(m.plan_name||'Ãrbol').toUpperCase()}</div>
            <div style="font-size:0.32rem;color:var(--px-muted);">
              ${Math.floor(m.hourly_rate||0)} ğŸ/hr
            </div>
          </div>
          <div style="font-family:'Press Start 2P',monospace;font-size:0.32rem;
            color:var(--px-green);text-shadow:0 0 6px rgba(0,230,118,.4);">
            â— ACTIVO
          </div>
        </div>`;
    }).join('');
  }

  function getEmoji(name) {
    const n = name.toLowerCase();
    if (n.includes('mÃ­sic') || n.includes('mistico') || n.includes('legendary')) return 'ğŸŒ¸';
    if (n.includes('dorad') || n.includes('elite'))   return 'âœ¨';
    if (n.includes('granny') || n.includes('master')) return 'ğŸŒ¿';
    if (n.includes('gala')  || n.includes('pro'))     return 'ğŸŒ¼';
    if (n.includes('fuji')  || n.includes('basic'))   return 'ğŸƒ';
    return 'ğŸŒ±';
  }

  // Cosechar: llama /api/mining/claim
  async function harvest() {
    const btn = $('af-harvest-btn');
    if (!btn || btn.disabled) return;
    btn.disabled = true;
    btn.innerHTML = 'â³ COSECHANDO...';

    try {
      const res  = await fetch('/api/mining/claim', {
        method:'POST', headers:{'Content-Type':'application/json'}
      });
      const data = await res.json();
      if (data.success) {
        pending = 0;
        tick();
        if (window.DogeQuest?.showToast) DogeQuest.showToast(data.message || 'ğŸ Cosecha exitosa!', 'success');
        if (window.DogeQuest?.createCoinRain) DogeQuest.createCoinRain(12);
        setTimeout(() => location.reload(), 1500);
      } else {
        if (window.DogeQuest?.showToast) DogeQuest.showToast(data.message || 'Error', 'error');
        btn.disabled = false;
        btn.innerHTML = 'ğŸ COSECHAR <span id="af-harvest-count">' + fmt(pending) + '</span> MANZANAS';
      }
    } catch(e) {
      if (window.DogeQuest?.showToast) DogeQuest.showToast('Error de conexiÃ³n', 'error');
      btn.disabled = false;
      btn.innerHTML = 'ğŸ COSECHAR <span id="af-harvest-count">' + fmt(pending) + '</span> MANZANAS';
    }
  }

  // Carga estado inicial desde /api/mining/stats
  async function load() {
    try {
      const res  = await fetch('/api/mining/stats');
      const data = await res.json();

      if (data.success) {
        pending  = parseFloat(data.pending_rewards) || 0;
        pph      = parseFloat(data.total_hourly_rate) || 0;
        trees    = parseInt(data.total_machines)  || 0;
        machines = data.machines || [];

        const te = $('af-trees'); if (te) te.textContent = trees;
        const re = $('af-rate');  if (re) re.textContent = fmt(pph);

        renderTrees();
      }
    } catch(e) {}

    // Inicia ticker en tiempo real
    lastTick  = Date.now();
    if (tickTimer) clearInterval(tickTimer);
    tickTimer = setInterval(tick, 500);
    tick();
  }

  // Refresca pendiente cada 30s sin recargar
  setInterval(async () => {
    try {
      const res  = await fetch('/api/mining/stats');
      const data = await res.json();
      if (data.success) {
        pending  = parseFloat(data.pending_rewards) || 0;
        pph      = parseFloat(data.total_hourly_rate) || 0;
        trees    = parseInt(data.total_machines) || 0;
        lastTick = Date.now();
      }
    } catch(e) {}
  }, 30000);

  load();

  return { harvest };
})();
</script>
{% endblock %}