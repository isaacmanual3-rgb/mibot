{% extends "base.html" %}
{% block title %}Apple Farm{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/apple_game.css') }}">
{% endblock %}

{% block content %}
<div class="farm-container">

    <!-- â•â• TOP STATS â•â• -->
    <div class="farm-stats-bar">
        <div class="stat-chip">
            <span class="stat-icon">ğŸ</span>
            <div class="stat-info">
                <span class="stat-label">Manzanas</span>
                <span class="stat-value" id="appleCount">{{ user.apples | default(0) | int }}</span>
            </div>
        </div>
        <div class="stat-chip">
            <span class="stat-icon">âš¡</span>
            <div class="stat-info">
                <span class="stat-label">Por hora</span>
                <span class="stat-value" id="applesPerHour">0</span>
            </div>
        </div>
        <div class="stat-chip">
            <span class="stat-icon">ğŸ…</span>
            <div class="stat-info">
                <span class="stat-label">Nivel</span>
                <span class="stat-value" id="userLevel">{{ user.level | default(1) }}</span>
            </div>
        </div>
    </div>

    <!-- â•â• NEXT APPLE TIMER â•â• -->
    <div class="timer-row">
        <div class="timer-pill">
            <span class="timer-dot"></span>
            <span id="nextAppleTimer">Calculando...</span>
        </div>
    </div>

    <!-- â•â• MAP IMAGE â•â• -->
    <div class="island-map-wrap">
        <img src="{{ url_for('static', filename='img/tavukaltlik.webp') }}" 
             alt="Apple Farm Islands" class="island-map-img" id="islandMap">

        <!-- Tree overlays â€” positioned over each island -->
        <div class="tree-nodes" id="treeNodes">
            <!-- Rendered by JS -->
        </div>
    </div>

    <!-- â•â• TREE CARDS â•â• -->
    <div class="tree-cards-section">
        <h2 class="section-title">ğŸŒ³ Tus Ãrboles</h2>
        <div class="tree-cards" id="treeCards">
            <!-- Rendered by JS -->
        </div>
    </div>

</div>

<!-- â•â• UNLOCK MODAL â•â• -->
<div class="modal-overlay" id="unlockModal" style="display:none">
    <div class="modal-box">
        <button class="modal-close" id="modalClose">âœ•</button>
        <div class="modal-icon" id="modalIcon">ğŸŒ³</div>
        <h3 class="modal-title" id="modalTitle">Ãrbol de Manzana</h3>
        <div class="modal-stats" id="modalStats"></div>
        <button class="btn-buy" id="modalBuyBtn">Comprar</button>
        <p class="modal-note" id="modalNote"></p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/apple_game.js') }}"></script>
{% endblock %}
