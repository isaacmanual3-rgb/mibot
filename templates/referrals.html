{% extends "base.html" %}

{% block title %}Referrals - Doge Pixel{% endblock %}

{% block content %}
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;500;600&display=swap');

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ROOT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --bg:        #08080f;
  --surface:   #0d0d1a;
  --surface2:  #111122;
  --surface3:  #070710;
  --gold:      #ffd700;
  --gold2:     #ffb300;
  --gold-dark: #5a3a00;
  --gold-dim:  rgba(255,215,0,0.07);
  --green:     #00e676;
  --blue:      #40c4ff;
  --orange:    #ff9800;
  --red:       #ff4d6a;
  --border:    #1e1e34;
  --text:      #e0e2f0;
  --text2:     #9090b8;
  --muted:     #4a4a6e;
  --font-px:   'Press Start 2P', monospace;
  --font-body: 'Inter', sans-serif;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHELL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.rf-shell {
  font-family: var(--font-body);
  background: var(--bg);
  min-height: 100vh;
  color: var(--text);
  position: relative;
  overflow-x: hidden;
}
.rf-shell::before {
  content: '';
  position: fixed; inset: 0;
  background-image:
    linear-gradient(rgba(255,255,255,0.011) 1px, transparent 1px),
    linear-gradient(90deg,rgba(255,255,255,0.011) 1px, transparent 1px);
  background-size: 24px 24px;
  pointer-events: none; z-index: 0;
}
.rf-shell::after {
  content: '';
  position: fixed; inset: 0;
  background: repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,0.055) 2px,rgba(0,0,0,0.055) 4px);
  pointer-events: none; z-index: 1;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TICKER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.rf-ticker {
  position: relative; z-index: 20;
  background: var(--gold);
  height: 28px; display: flex; align-items: center;
  overflow: hidden;
  border-bottom: 3px solid var(--gold-dark);
}
.rf-ticker span {
  display: inline-block; white-space: nowrap;
  font-family: var(--font-px); font-size: 0.42rem;
  color: #0a0800; letter-spacing: 0.08em;
  animation: rf-tick 32s linear infinite;
}
@keyframes rf-tick {
  from { transform: translateX(100vw); }
  to   { transform: translateX(-100%); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.rf-page {
  position: relative; z-index: 5;
  max-width: 560px; margin: 0 auto;
  padding: 20px 14px 80px;
  display: flex; flex-direction: column; gap: 14px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PIXEL CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.rf-card {
  background: var(--surface);
  border: 2px solid var(--border);
  box-shadow: 4px 4px 0 0 #030308;
  position: relative;
  padding: 20px;
  animation: rf-up 0.3s ease both;
}
.rf-card::before, .rf-card::after {
  content: ''; position: absolute;
  width: 9px; height: 9px;
  border-color: var(--gold); border-style: solid;
}
.rf-card::before { top:-2px; left:-2px; border-width:2px 0 0 2px; }
.rf-card::after  { bottom:-2px; right:-2px; border-width:0 2px 2px 0; }

.rf-card:nth-child(1){animation-delay:.04s}
.rf-card:nth-child(2){animation-delay:.09s}
.rf-card:nth-child(3){animation-delay:.14s}
.rf-card:nth-child(4){animation-delay:.19s}
.rf-card:nth-child(5){animation-delay:.24s}
.rf-card:nth-child(6){animation-delay:.29s}

@keyframes rf-up {
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:translateY(0)}
}

/* Section label */
.rf-label {
  font-family: var(--font-px); font-size: 0.42rem;
  color: var(--muted); letter-spacing: 0.18em; text-transform: uppercase;
  display: flex; align-items: center; gap: 8px; margin-bottom: 16px;
}
.rf-label::after {
  content: ''; flex: 1; height: 1px; background: var(--border);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CSS PIXEL ART ICONS  (3px per pixel)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.px-icon {
  display:flex; align-items:center; justify-content:center;
  width:22px; height:22px; flex-shrink:0;
}
.px-icon svg {
  width:100%; height:100%; display:block;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HERO CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.rf-hero {
  background: linear-gradient(160deg, #0a0a18 0%, #0d0d22 100%);
  border: 2px solid var(--gold-dark);
  box-shadow: 4px 4px 0 0 #020201, 0 0 40px rgba(255,215,0,0.06);
  padding: 28px 20px;
  text-align: center;
  position: relative; overflow: hidden;
  animation: rf-up .3s .04s ease both;
}
.rf-hero::before,.rf-hero::after {
  content:''; position:absolute; width:9px; height:9px;
  border-color:var(--gold); border-style:solid;
}
.rf-hero::before{top:-2px;left:-2px;border-width:2px 0 0 2px}
.rf-hero::after{bottom:-2px;right:-2px;border-width:0 2px 2px 0}

/* glow orb */
.rf-hero-glow {
  position:absolute; top:-40px; left:50%; transform:translateX(-50%);
  width:180px; height:180px;
  background: radial-gradient(circle, rgba(255,215,0,0.1) 0%, transparent 70%);
  pointer-events:none;
}

.rf-hero-icon {
  width: 56px; height: 56px;
  background: var(--gold-dim);
  border: 2px solid var(--gold-dark);
  box-shadow: 3px 3px 0 0 #020201;
  display: flex; align-items: center; justify-content: center;
  margin: 0 auto 18px;
}

.rf-hero-title {
  font-family: var(--font-px);
  font-size: 0.78rem;
  color: var(--gold);
  text-shadow: 2px 2px 0 var(--gold-dark), 0 0 16px rgba(255,215,0,0.3);
  letter-spacing: 0.08em;
  margin-bottom: 12px;
  animation: rf-flicker 5s ease infinite;
}
@keyframes rf-flicker {
  0%,91%,93%,95%,100%{opacity:1} 92%,94%{opacity:0.55}
}

.rf-hero-desc {
  font-size: 0.82rem; color: var(--text2); line-height: 1.6;
}
.rf-hero-desc strong {
  color: var(--gold);
  font-family: var(--font-px); font-size: 0.68rem;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATS GRID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.rf-stats {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}
.rf-stat {
  background: var(--surface3);
  border: 2px solid var(--border);
  box-shadow: 3px 3px 0 0 #020205;
  padding: 16px 12px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  text-align: center;
  position: relative;
}
.rf-stat-icon-wrap {
  width: 38px; height: 38px;
  background: var(--surface);
  border: 2px solid var(--border);
  display: flex; align-items: center; justify-content: center;
}
.rf-stat-val {
  font-family: var(--font-px); font-size: 0.78rem;
  color: var(--gold);
  text-shadow: 2px 2px 0 var(--gold-dark), 0 0 10px rgba(255,215,0,0.2);
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
  max-width: 100%;
}
.rf-stat-lbl {
  font-size: 0.6rem; font-weight: 600;
  color: var(--muted); letter-spacing: 0.1em; text-transform: uppercase;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INVITE LINK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.rf-link-row {
  display: flex; gap: 8px; margin-bottom: 12px;
}
.rf-link-input {
  flex: 1;
  background: var(--surface3);
  border: 2px solid var(--border);
  box-shadow: inset 2px 2px 0 0 #020205;
  padding: 12px 14px;
  font-family: var(--font-body); font-size: 0.75rem;
  color: var(--text2);
  outline: none;
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
  min-width: 0;
}
.rf-btn-copy {
  flex-shrink: 0;
  font-family: var(--font-px); font-size: 0.44rem;
  letter-spacing: 0.06em;
  padding: 0 14px;
  background: var(--surface);
  color: var(--text);
  border: 2px solid var(--border);
  box-shadow: 3px 3px 0 0 #030308;
  cursor: pointer;
  display: flex; align-items: center; gap: 6px;
  transition: transform .07s, box-shadow .07s, color .1s, border-color .1s;
  height: 46px;
}
.rf-btn-copy:hover { transform:translate(-1px,-1px); box-shadow:4px 4px 0 0 #030308; color:var(--gold); border-color:var(--gold-dark); }
.rf-btn-copy:active{ transform:translate(2px,2px); box-shadow:1px 1px 0 0 #030308; }
.rf-btn-copy.copied{ color:var(--green); border-color:rgba(0,230,118,0.35); }

.rf-btn-share {
  width: 100%;
  font-family: var(--font-px); font-size: 0.5rem;
  letter-spacing: 0.06em;
  padding: 15px;
  background: var(--gold);
  color: #0a0800;
  border: 2px solid var(--gold2);
  box-shadow: 4px 4px 0 0 var(--gold-dark);
  cursor: pointer; display: block; text-align: center;
  transition: transform .07s, box-shadow .07s;
}
.rf-btn-share:hover { transform:translate(-1px,-1px); box-shadow:5px 5px 0 0 var(--gold-dark); }
.rf-btn-share:active{ transform:translate(2px,2px); box-shadow:2px 2px 0 0 var(--gold-dark); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOW IT WORKS â€” STEPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.rf-steps {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 4px;
}
.rf-step {
  display: flex; flex-direction: column; align-items: center;
  gap: 8px; flex: 1;
}
.rf-step-num {
  width: 26px; height: 26px;
  background: var(--gold); color: #0a0800;
  font-family: var(--font-px); font-size: 0.5rem;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 2px 2px 0 0 var(--gold-dark);
  flex-shrink: 0;
}
.rf-step-icon {
  width: 36px; height: 36px;
  background: var(--surface3);
  border: 2px solid var(--border);
  display: flex; align-items: center; justify-content: center;
}
.rf-step-lbl {
  font-size: 0.6rem; color: var(--text2);
  text-align: center; line-height: 1.4;
  max-width: 58px;
}
.rf-step-arrow {
  font-family: var(--font-px); font-size: 0.5rem;
  color: var(--muted); margin-top: 20px; flex-shrink: 0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REFERRALS LIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.rf-list {
  display: flex; flex-direction: column; gap: 8px;
}
.rf-item {
  background: var(--surface3);
  border: 2px solid var(--border);
  box-shadow: 2px 2px 0 0 #020205;
  display: flex; align-items: center; gap: 12px;
  padding: 12px 14px;
  position: relative;
}
.rf-item::before {
  content: ''; position: absolute; left: 0; top: 0; bottom: 0;
  width: 3px; background: var(--muted);
}
.rf-item.validated::before { background: var(--green); }

.rf-avatar {
  flex-shrink: 0;
  width: 38px; height: 38px;
  background: var(--surface);
  border: 2px solid var(--border);
  box-shadow: 2px 2px 0 0 #020205;
  display: flex; align-items: center; justify-content: center;
  font-family: var(--font-px); font-size: 0.7rem;
  color: var(--gold);
  text-shadow: 1px 1px 0 var(--gold-dark);
}
.rf-item.validated .rf-avatar {
  border-color: rgba(0,230,118,0.3);
  background: rgba(0,230,118,0.05);
  color: var(--green); text-shadow: none;
}

.rf-item-body { flex: 1; min-width: 0; }
.rf-item-name {
  display: block; font-family: var(--font-px);
  font-size: 0.44rem; color: var(--text);
  letter-spacing: 0.04em; margin-bottom: 5px;
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}
.rf-item-date { font-size: 0.65rem; color: var(--muted); }

.rf-badge {
  flex-shrink: 0;
  font-family: var(--font-px); font-size: 0.38rem;
  letter-spacing: 0.06em; padding: 5px 8px;
  border: 2px solid; display: flex; align-items: center; gap: 5px;
}
.rf-badge.validated {
  color: var(--green); border-color: rgba(0,230,118,0.35);
  background: rgba(0,230,118,0.06);
}
.rf-badge.pending {
  color: var(--orange); border-color: rgba(255,152,0,0.3);
  background: rgba(255,152,0,0.05);
}

/* Empty */
.rf-empty {
  padding: 40px 20px; text-align: center;
}
.rf-empty-icon {
  width: 42px; height: 42px;
  background: var(--surface3); border: 2px solid var(--border);
  display: flex; align-items: center; justify-content: center;
  margin: 0 auto 16px;
  animation: rf-bounce .9s steps(1) infinite;
}
@keyframes rf-bounce {
  0%,100%{transform:translateY(0)} 50%{transform:translateY(-5px)}
}
.rf-empty-title {
  font-family: var(--font-px); font-size: 0.5rem;
  color: var(--text2); letter-spacing: 0.06em; margin-bottom: 10px;
}
.rf-empty-hint { font-size: 0.78rem; color: var(--muted); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MILESTONES / TIERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.rf-tiers { display: flex; flex-direction: column; gap: 10px; }

.rf-tier {
  background: var(--surface3);
  border: 2px solid var(--border);
  box-shadow: 2px 2px 0 0 #020205;
  display: flex; align-items: center; gap: 14px;
  padding: 14px;
  position: relative; overflow: hidden;
  opacity: 0.5;
  transition: opacity .2s;
}
.rf-tier::before {
  content: ''; position: absolute; left: 0; top: 0; bottom: 0;
  width: 3px; background: var(--muted);
}
.rf-tier.unlocked {
  opacity: 1;
  border-color: rgba(255,215,0,0.3);
  background: rgba(255,215,0,0.04);
}
.rf-tier.unlocked::before { background: var(--gold); }

.rf-tier-icon {
  width: 40px; height: 40px; flex-shrink: 0;
  background: var(--surface);
  border: 2px solid var(--border);
  display: flex; align-items: center; justify-content: center;
}
.rf-tier.unlocked .rf-tier-icon {
  background: var(--gold-dim);
  border-color: var(--gold-dark);
}

.rf-tier-body { flex: 1; }
.rf-tier-name {
  display: block;
  font-family: var(--font-px); font-size: 0.48rem;
  color: var(--text); letter-spacing: 0.06em; margin-bottom: 5px;
}
.rf-tier.unlocked .rf-tier-name { color: var(--gold); text-shadow: 1px 1px 0 var(--gold-dark); }
.rf-tier-goal { font-size: 0.68rem; color: var(--muted); }

.rf-tier-reward {
  flex-shrink: 0;
  font-family: var(--font-px); font-size: 0.42rem;
  color: var(--text2); text-align: right;
  line-height: 1.6;
}
.rf-tier.unlocked .rf-tier-reward { color: var(--gold); text-shadow: 1px 1px 0 var(--gold-dark); }

.rf-tier-badge {
  position: absolute; top: 8px; right: 8px;
  font-family: var(--font-px); font-size: 0.32rem;
  padding: 3px 6px; letter-spacing: 0.06em;
}
.rf-tier.unlocked .rf-tier-badge {
  background: rgba(0,230,118,0.1); border: 1px solid rgba(0,230,118,0.3);
  color: var(--green);
}
.rf-tier:not(.unlocked) .rf-tier-badge { display: none; }

@media (max-width: 400px) {
  .rf-steps { gap: 2px; }
  .rf-step-lbl { font-size: 0.55rem; max-width: 48px; }
  .rf-step-arrow { font-size: 0.4rem; }
}
</style>

<div class="rf-shell">

  <!-- Ticker -->
  <div class="rf-ticker" aria-hidden="true">
    <span>
      â˜… REFERRALS â˜…&nbsp;&nbsp;&nbsp;
      INVITE FRIENDS & EARN TON TOGETHER &nbsp;â˜…&nbsp;&nbsp;&nbsp;
      MORE FRIENDS = MORE TON &nbsp;â˜…&nbsp;&nbsp;&nbsp;
      UNLOCK MILESTONE BONUSES &nbsp;â˜…&nbsp;&nbsp;&nbsp;
      MUCH REFER. VERY EARN. SO TON. &nbsp;â˜…&nbsp;&nbsp;&nbsp;
    </span>
  </div>

  <div class="rf-page">

    <!-- â”€â”€ HERO â”€â”€ -->
    <div class="rf-hero">
      <div class="rf-hero-glow" aria-hidden="true"></div>
      <div class="rf-hero-icon">
        <span class="px-icon"><svg viewBox="0 0 24 24" fill="none" stroke="#ffd700" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></span>
      </div>
      <div class="rf-hero-title">{{ t.rf_title }}</div>
      <div class="rf-hero-desc">
        Earn <strong>{{ format_ton(referral_bonus) }} TON</strong>
        for each friend who completes a task!
      </div>
    </div>

    <!-- â”€â”€ STATS â”€â”€ -->
    <div class="rf-card" style="padding:0; overflow:hidden;">
      <div class="rf-stats">
        <div class="rf-stat">
          <div class="rf-stat-icon-wrap">
            <span class="px-icon"><svg viewBox="0 0 24 24" fill="none" stroke="#40c4ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg></span>
          </div>
          <span class="rf-stat-val">{{ total_referrals }}</span>
          <span class="rf-stat-lbl">{{ t.rf_total_invites }}</span>
        </div>
        <div class="rf-stat">
          <div class="rf-stat-icon-wrap">
            <span class="px-icon"><svg viewBox="0 0 24 24" fill="none" stroke="#00e676" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg></span>
          </div>
          <span class="rf-stat-val">{{ validated_referrals }}</span>
          <span class="rf-stat-lbl">{{ t.rf_validated }}</span>
        </div>
        <div class="rf-stat">
          <div class="rf-stat-icon-wrap">
            <span class="px-icon"><svg viewBox="0 0 24 24" fill="none" stroke="#ff9800" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></span>
          </div>
          <span class="rf-stat-val">{{ pending_referrals }}</span>
          <span class="rf-stat-lbl">{{ t.rf_pending }}</span>
        </div>
        <div class="rf-stat" style="border-top:2px solid rgba(255,215,0,0.15); background:rgba(255,215,0,0.04);">
          <div class="rf-stat-icon-wrap" style="border-color:var(--gold-dark); background:var(--gold-dim);">
            <span class="px-icon"><svg viewBox="0 0 24 24" fill="none" stroke="#ffd700" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.5 9.5C10 8.5 11 8 12 8s2.5.5 2.5 2-1 2-2.5 2-2.5.5-2.5 2 1 2.5 2.5 2.5 2.5-.5 2.5-2" stroke-width="1.5"/><path d="M12 6v1m0 10v1" stroke-width="1.5"/></svg></span>
          </div>
          <span class="rf-stat-val">{{ format_ton(referral_earnings) }}</span>
          <span class="rf-stat-lbl">{{ t.rf_total_earned }}</span>
        </div>
      </div>
    </div>

    <!-- â”€â”€ INVITE LINK â”€â”€ -->
    <div class="rf-card">
      <div class="rf-label">
        <span class="px-icon" style="flex-shrink:0; margin-right:4px;"><svg viewBox="0 0 24 24" fill="none" stroke="#40c4ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg></span>
        Your Invite Links
      </div>

      <!-- Telegram Mini App Link -->
      <div style="margin-bottom:8px; font-size:0.7rem; color:#aaa; font-family:'Press Start 2P',cursive;">{{ t.rf_your_link }}</div>
      <div class="rf-link-row" style="margin-bottom:16px;">
        <input type="text" id="inviteLink" value="{{ referral_link }}" readonly class="rf-link-input">
        <button class="rf-btn-copy" id="copyBtn" onclick="copyLink('inviteLink','copyBtn')">
          <span class="px-icon"><svg viewBox="0 0 24 24" fill="none" stroke="#40c4ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg></span>
          COPY
        </button>
      </div>

      <button class="rf-btn-share" onclick="shareTelegram()">
        <span class="px-icon" style="display:inline-block; vertical-align:middle; margin-right:10px; transform:scale(0.8)"><svg viewBox="0 0 24 24" fill="none" stroke="#ffd700" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg></span>
        {{ t.rf_share_telegram }}
      </button>
    </div>

    <!-- â”€â”€ HOW IT WORKS â”€â”€ -->
    <div class="rf-card">
      <div class="rf-label">
        <span class="px-icon" style="flex-shrink:0; margin-right:4px;"><svg viewBox="0 0 24 24" fill="none" stroke="#ffd700" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17" stroke-width="3"/></svg></span>
        How It Works
      </div>
      <div class="rf-steps">
        <div class="rf-step">
          <div class="rf-step-num">1</div>
          <div class="rf-step-icon">
            <span class="px-icon"><svg viewBox="0 0 24 24" fill="none" stroke="#ffd700" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg></span>
          </div>
          <div class="rf-step-lbl">{{ t.rf_share_link }}</div>
        </div>
        <div class="rf-step-arrow">â†’</div>
        <div class="rf-step">
          <div class="rf-step-num">2</div>
          <div class="rf-step-icon">
            <span class="px-icon"><svg viewBox="0 0 24 24" fill="none" stroke="#ffd700" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></span>
          </div>
          <div class="rf-step-lbl">{{ t.rf_friend_visits }}</div>
        </div>
        <div class="rf-step-arrow">â†’</div>
        <div class="rf-step">
          <div class="rf-step-num">3</div>
          <div class="rf-step-icon">
            <span class="px-icon"><svg viewBox="0 0 24 24" fill="none" stroke="#ffd700" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.5 9.5C10 8.5 11 8 12 8s2.5.5 2.5 2-1 2-2.5 2-2.5.5-2.5 2 1 2.5 2.5 2.5 2.5-.5 2.5-2" stroke-width="1.5"/><path d="M12 6v1m0 10v1" stroke-width="1.5"/></svg></span>
          </div>
          <div class="rf-step-lbl">{{ t.rf_you_earn }}</div>
        </div>
      </div>
      <p style="margin-top:12px; font-size:0.7rem; color:#888; text-align:center; line-height:1.8;">
        âœ… Tu referido se cuenta automÃ¡ticamente cuando tu amigo abre la app por tu link â€” Â¡sin completar tareas!
      </p>
    </div>

    <!-- â”€â”€ REFERRALS LIST â”€â”€ -->
    <div class="rf-card">
      <div class="rf-label">
        <span class="px-icon" style="flex-shrink:0; margin-right:4px;"><svg viewBox="0 0 24 24" fill="none" stroke="#40c4ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg></span>
        Your Referrals
      </div>

      {% if referrals %}
      <div class="rf-list">
        {% for ref in referrals %}
        <div class="rf-item {% if ref.validated %}validated{% else %}pending{% endif %}">
          <div class="rf-avatar">
            {{ (ref.referred_username or ref.referred_first_name or '?')[0]|upper }}
          </div>
          <div class="rf-item-body">
            <span class="rf-item-name">{{ ref.referred_username or ref.referred_first_name or 'Anonymous' }}</span>
            <span class="rf-item-date">Joined {{ ref.created_at.strftime('%b %d') if ref.created_at else 'Recently' }}</span>
          </div>
          <div>
            {% if ref.validated %}
            <span class="rf-badge validated">
              <span class="px-icon"><svg viewBox="0 0 24 24" fill="none" stroke="#00e676" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg></span>
              +{{ format_ton(referral_bonus) }}
            </span>
            {% else %}
            <span class="rf-badge pending">
              <span class="px-icon"><svg viewBox="0 0 24 24" fill="none" stroke="#ff9800" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></span>
              PENDING
            </span>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>

      {% else %}
      <div class="rf-empty">
        <div class="rf-empty-icon">
          <span class="px-icon"><svg viewBox="0 0 24 24" fill="none" stroke="#ffd700" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></span>
        </div>
        <div class="rf-empty-title">{{ t.rf_no_friends }}</div>
        <div class="rf-empty-hint">Share your link to start earning!</div>
      </div>
      {% endif %}
    </div>

    </div>

  </div>
</div>

<script>
function copyLink(inputId, btnId) {
  const input = document.getElementById(inputId);
  input.select();
  try { document.execCommand('copy'); } catch(e) {
    navigator.clipboard && navigator.clipboard.writeText(input.value);
  }
  const btn = document.getElementById(btnId);
  const orig = btn.innerHTML;
  btn.innerHTML = 'âœ“ COPIED!';
  btn.classList.add('copied');
  showToast && showToast('Link copied!', 'success');
  setTimeout(() => { btn.innerHTML = orig; btn.classList.remove('copied'); }, 2000);
}

// Legacy alias
function copyInviteLink() { copyLink('inviteLink','copyBtn'); }

function shareTelegram() {
  const link = document.getElementById('inviteLink').value;
  const text = 'ğŸ• Â¡Ãšnete a Doge Pixel y gana TON gratis! Completa misiones, haz check-in diario y retira TON real. \n\nğŸ‘‡ Entra aquÃ­:';
  // For Mini App links, use openTelegramLink with share URL
  const shareUrl = `https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent(text)}`;
  if (window.Telegram && window.Telegram.WebApp) {
    window.Telegram.WebApp.openTelegramLink(shareUrl);
  } else {
    window.open(shareUrl, '_blank');
  }
}
</script>
{% endblock %}
